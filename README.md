# Border Tally（出入境记录自动计算）

Border Tally 是一个**纯前端**工具：上传「国家移民管理局」下载的出入境记录 PDF 后，自动解析并计算你在指定时间范围内的**境外停留天数**，并以可视化方式展示结果与明细，帮助你快速核对出入境数据。

> 说明：本项目的核心目标是 **出入境记录的自动解析与天数计算**。页面中出现的“资格判断”仅作为常见需求的附加展示，不作为产品定位的中心。

---

## 功能介绍

- **PDF 自动解析**：直接上传出入境记录 PDF，自动提取出入境日期、口岸、证件信息等
- **境外停留天数自动计算**：在你设定的时间范围内，计算境外停留天数（并展示境内停留、未来区间等辅助信息）
- **口岸概览（最常去的口岸 TOP3）**：在结果卡片“背面”查看时间范围内最常出现的口岸，并用交通方式图标辅助识别
- **数据修正与提示**：
  - 自动处理证件不匹配等常见问题
  - 提示同日多次出入境等情况，便于人工核对
- **隐私保护**：所有计算在浏览器本地完成，不上传到服务器

---

## 使用说明

1. **准备 PDF**
   - 从「国家移民管理局」相关入口下载你的出入境记录 PDF

2. **上传 PDF**
   - 打开网页后上传 PDF 文件，系统会自动解析并展示可用的记录

3. **设定时间范围**
   - 在「设定时间范围」中选择开始/结束日期
   - 可使用快捷选项快速生成常见跨度（例如 1 年、1.5 年、4 年等）

4. **查看结果**
   - 正面：查看“境外/境内”天数占比与结果摘要
   - 背面：点击“查看口岸”，查看**最常去的口岸** TOP3

5. **（可选）导出/分享**
   - 页面提供导出图片等操作（如你需要用于存档或提交材料）

---

## 境外停留天数：计算口径（重要）

为避免时区与边界日导致的偏差，本项目统一采用 **中国标准时间 CST（UTC+8）的“日历日”语义**进行计算。

### 1) 日期语义
- PDF 中的日期为 `YYYY-MM-DD`，按 **CST 日历日**理解
- 你在界面选择的日期范围同样按 **CST 日历日**理解
- 所有天数计算都在“date-only”空间进行，避免本地时区差造成的 +1/-1

### 2) 境外段定义（出境～入境）
- 一次“境外停留段”为：`[出境日, 入境日]`
- **首尾都计入**（inclusive）
  - 例如：同一天出境并入境，该段计为 **1 天**
- 若最后一条记录为“出境”（表示仍在境外），则该段从出境日一直计到 **今日（CST）**（同样包含当日）

### 3) 多证件口径
- 出入境记录会按证件维度分组计算（例如护照、港澳通行证等）
- 不同证件的数据不会互相“串段”导致误算

### 4) 时间范围裁剪（仅统计你选择的区间）
- 最终统计仅计算你设定的 `[开始日, 结束日]` 区间内的境外天数
- 超出区间的天数不计入

---

## 开源库与致谢

本项目使用/参考了以下开源库（排名不分先后）：

- **Radix UI**：可访问性良好的交互组件基础（HoverCard / Dialog / Toast 等）
- **shadcn/ui**：UI 组件风格与封装参考
- **Recharts**：图表可视化（饼图等）
- **pdf-parse**：PDF 文本解析
- **date-fns**：日期处理与格式化
- **lucide-react**：图标

---

## 项目结构（关键文件）

```
border-tally/
├─ app/
│  ├─ layout.tsx                 # 应用布局
│  └─ page.tsx                   # 主页面
├─ components/
│  ├─ date-range-picker.tsx      # 设定时间范围（含快捷选项）
│  ├─ pdf-upload.tsx             # PDF 上传与解析入口
│  ├─ result-card.tsx            # 结果卡片（含“正面/背面”与口岸 TOP3）
│  ├─ result-actions.tsx         # 导出/分享相关操作
│  └─ ui/                        # UI 组件封装（含 Radix primitives）
├─ lib/
│  ├─ border-calculation.ts      # 境外天数计算（核心口径、时区语义）
│  ├─ data-correction.ts         # 数据修正与问题提示
│  └─ pdf-parser.ts              # PDF 解析逻辑
├─ types/
│  └─ index.ts                   # 类型定义（BorderRecord 等）
└─ public/                       # 静态资源
```

---

## 免责声明

本工具仅用于个人核对与辅助计算，结果仅供参考；请以官方口径与最终解释为准。项目作者不对使用本工具产生的任何后果承担责任。